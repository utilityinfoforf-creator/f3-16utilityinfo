<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Make Payment - Utility Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="container">
    <div class="page-header">
      <h1 id="label-payment-title">üí≥ Make a Payment</h1>
      <p id="label-payment-subtitle">Choose your payment method</p>
    </div>

    <!-- Login Section -->
    <div id="login" class="card">
      <h3 id="label-login-required">Login Required</h3>
      <p id="label-login-instruction">Enter your Customer ID to proceed:</p>
      <div class="form-group">
        <input id="customerId" placeholder="Enter your Customer ID" type="text">
      </div>
      <div class="form-group">
        <button onclick="login()" id="btn-login-action">Login</button>
      </div>
      <div id="error" class="error" style="display:none;"></div>
    </div>

    <!-- Payment Section (hidden until login) -->
    <div id="dashboard" style="display:none;">
      <div class="card">
        <h3 id="label-select-method">Select Payment Method</h3>
        <p id="label-choose-how">Choose how you'd like to pay:</p>
        <div class="options">
          <button onclick="showSteps('bkash')">üè¶ bKash</button>
          <button onclick="showSteps('nagad')">üí∏ Nagad</button>
        </div>
      </div>

      <div id="steps" class="steps"></div>

      <!-- Transaction confirmation box -->
      <div class="card">
        <h3 id="label-confirm-payment">Confirm Your Payment</h3>
        <p id="label-enter-details">Enter your transaction details:</p>
        <div class="form-group">
          <input id="transactionNumber" placeholder="Enter Transaction Number" type="text">
        </div>
        <div class="form-group">
          <button class="submit-btn" onclick="submitTransaction()" id="btn-submit-payment">Submit Payment Confirmation</button>
        </div>
        <div id="confirmMsg"></div>
      </div>

      <button class="btn btn-back" onclick="goBack()" id="btn-back-dash">‚Üê Back to Dashboard</button>
    </div>
  </div>

  <script src="script.js"></script>
  <script>
    // Local additions for payment specific logic
    function showSteps(option) {
      const stepsDiv = document.getElementById("steps");
      let html = "";
      if (option === "bkash") {
        html = `
          <h3>bKash Payment Steps</h3>
          <div class="step"><p><b>Step 1:</b> Open bKash app and log in</p></div>
          <div class="step"><p><b>Step 2:</b> Tap 'Send Money'</p></div>
          <div class="step"><p><b>Step 3:</b> Enter the number (01727389485)</p></div>
          <div class="step"><p><b>Step 4:</b> Enter amount and reference (your Customer ID)</p></div>
          <div class="step"><p><b>Step 5:</b> Confirm and enter PIN</p></div>
        `;
      } else if (option === "nagad") {
        html = `
          <h3>Nagad Payment Steps</h3>
          <div class="step"><p><b>Step 1:</b> Open Nagad app and log in</p></div>
          <div class="step"><p><b>Step 2:</b> Tap 'Bill Pay' or 'Payment'</p></div>
          <div class="step"><p><b>Step 3:</b> Enter merchant ID or choose service</p></div>
          <div class="step"><p><b>Step 4:</b> Enter amount and reference (your Customer ID)</p></div>
          <div class="step"><p><b>Step 5:</b> Confirm and enter PIN</p></div>
        `;
      }
      stepsDiv.innerHTML = html;
    }

    async function submitTransaction() {
      const id = localStorage.getItem("customerId");
      const txn = document.getElementById("transactionNumber").value.trim();
      const msgEl = document.getElementById("confirmMsg");

      if (!id || !txn) {
        msgEl.innerText = "Please enter Transaction Number.";
        msgEl.className = "error";
        return;
      }

      try {
        const res = await fetch(`${API_BASE}?id=${encodeURIComponent(id)}&transaction=${encodeURIComponent(txn)}`);
        const data = await res.json();
        if (data.status || (typeof data === 'string' && data.includes("success"))) {
          msgEl.innerText = data.status || data;
          msgEl.className = "success";
        } else if (data.error) {
          msgEl.innerText = data.error;
          msgEl.className = "error";
        }
      } catch (err) {
        msgEl.innerText = "Network error";
        msgEl.className = "error";
      }
    }

    function goBack() {
      window.location.href = "index.html";
    }

    // Extend updatePageLanguage for payment page
    const oldUpdate = updatePageLanguage;
    updatePageLanguage = function() {
      oldUpdate();
      const t = translations[currentLanguage];
      if (currentLanguage === 'bn') {
        document.getElementById('label-payment-title').innerText = "üí≥ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®";
        document.getElementById('label-payment-subtitle').innerText = "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø ‡¶ö‡¶Ø‡¶º‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®";
        document.getElementById('label-login-required').innerText = "‡¶≤‡¶ó‡¶á‡¶® ‡¶™‡ßç‡¶∞‡¶Ø‡¶º‡ßã‡¶ú‡¶®";
        document.getElementById('label-login-instruction').innerText = "‡¶è‡¶ó‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ø‡ßá‡¶§‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡¶Æ‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®:";
        document.getElementById('btn-login-action').innerText = "‡¶≤‡¶ó‡¶á‡¶®";
        document.getElementById('label-select-method').innerText = "‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®";
        document.getElementById('label-choose-how').innerText = "‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶® ‡¶§‡¶æ ‡¶ö‡¶Ø‡¶º‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®:";
        document.getElementById('label-confirm-payment').innerText = "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶ï‡¶∞‡ßÅ‡¶®";
        document.getElementById('label-enter-details').innerText = "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡ßá‡¶®‡¶¶‡ßá‡¶®‡ßá‡¶∞ ‡¶¨‡¶ø‡¶¨‡¶∞‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®:";
        document.getElementById('btn-submit-payment').innerText = "‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§‡¶ï‡¶∞‡¶£ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶®";
        document.getElementById('btn-back-dash').innerText = "‚Üê ‡¶°‡ßç‡¶Ø‡¶æ‡¶∂‡¶¨‡ßã‡¶∞‡ßç‡¶°‡ßá ‡¶´‡¶ø‡¶∞‡ßá ‡¶Ø‡¶æ‡¶®";
      }
    };
  </script>
</body>
</html>